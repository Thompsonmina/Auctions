{% extends "auctions/layout.html" %}
{% load crispy_forms_tags %}

{% block body %}
	{% load static %}
  	<script type="text/javascript" src="{% static 'auctions/single_listing.js' %}"></script> 
   <h2> Single Listing </h2>	


   {{ listing.id|json_script:"get-id" }}
   {{ is_in_watchlist|json_script:""}}
   {{ listing }}


   {%for bid in bids%}
    	<div>
    		{{ bid.amount }}
    		{{ bid.owner }}
    	</div>
    {% endfor %}

    {%for comment in comments%}
    	<div>
    		{{ comment.comment }}
    		{{ comment.commenter }}
    	</div>
    {% endfor %}

   <span id="id"></span>
   {% if user.is_authenticated and not user_is_winner and not user == listing.seller %}

		<button id="edit-watchlist"> {{listing.seller}}</button>

		{% if listing.isActive %}
		    <form method="post" action="{% url 'make_bid' listing_id=listing.id %}">
			   	{% csrf_token %}
			   	<input type="number" step="0.01" name="bid" required="true">
			   	<input type="submit" value="Bid" required="true">
		   	</form>
	   	{% endif %}
	   	
		<form method="post" action="{% url 'add_comment' listing_id=listing.id %}">
		   	{% csrf_token %}
		   	{{ commentform|crispy }}
		   	<input type="submit" value="comment" required="true">
	    </form>
	    

	    {% if user_is_winner %}
  			<p> {{user}}  has won the bid </p>
  		{% endif %}

  		{% if user == listing.seller %}
  			<button id=close-bid> close bid</button>     
  		{% endif %}

    {% endif %}
  	
{% endblock %}